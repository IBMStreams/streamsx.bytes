namespace com.ibm.streamsx.bytes.sample ;

use com.ibm.streamsx.bytes::* ;

composite Operators
{
	graph
	/*
	 * Producing data
	 */
		stream<uint64 id, rstring raw> RawData = Beacon(){
//			param
//				iterations:1u;
			output
//				RawData : id=0ul,raw="4154420142423030303030303034424230303030303030343335363534313033333230303030304632303832303131333435363738393046523230380D02680268026800010700000138FED98038FED9802EE1C095918CD0909254D0D50C0C0C0C0C0C0C0D00000032000000324000003240000032000000320000003340000033800000330000003280000032400B400B000B000AC00A800A800A000A000A000A000A000A000A000A000A000A000A000A000A000A000A000A000A000A000A000A000A000A000A000A000A000A400B800B800B800B800B800B800B800B800B800B800B400B400B400B400B400B400B400B400B400B400B400B400B400B000B000B000B000A801E857A029B32BC001E857A429B32BC401E857A829B32BC801E857A829B32BC801E857AC29B32BC801E857AC29B32BC401E857B029B32BC001E857B429B32BC001E857B829B32BB801E857BC29B32BB80424141C1C24141C1C1D555A8924B24928925808440422040201008040C6309C124129228A4E738844109000100000800100420049CA0A628CB008B0005A0008000800080008000C001E84810130203227323632C8332C339033F4109A10CC110811301162119410CC110811301162119410CC110811301162119410CC110811301162119410CC110811301162119410CC110811301162119410CC110811301162119410CC110811301162119410CC110811301162119410CC110811301162119410CC110811301162119410CC1108113011621212490000272ADA17E0700000138FED98038FED9802EE1C095918CD0909254D0D50C0C0C0C0C0C0C0D00000032000000324000003240000032000000320000003340000033800000330000003280000032400B400B000B000AC00A800A800A000A000A000A000A000A000A000A000A000A000A000A000A000A000A000A000A000A000A000A000A000A000A000A000A000A400B800B800B800B800B800B800B800B800B800B800B400B400B400B400B400B400B400B400B400B400B400B400B400B000B000B000B000A801E857A029B32BC001E857A429B32BC401E857A829B32BC801E857A829B32BC801E857AC29B32BC801E857AC29B32BC401E857B029B32BC001E857B429B32BC001E857B829B32BB801E857BC29B32BB80424141C1C24141C1C1D555A8924B24928925808440422040201008040C6309C124129228A4E7388441090001000008001004200450A0A628CD808B0005A0008000800080008000C001E84810130203227323632C8332C339033F4109A10CC110811301162119410CC110811301162119410CC110811301162119410CC110811301162119410CC110811301162119410CC110811301162119410CC110811301162119410CC110811301162119410CC110811301162119410CC110811301162119410CC110811301162119410CC1108113011621212490000272ADF17E0800000138FED98038FED980278B9C7DFF6CC01564633424249534354303030303030303400004101438FED9803039000000C80001007A15E80A6CCAF00140000032000000324000003280000032C0000032C0000032C0000032C0000032C0000032C00000348000003480000034800000348000003480000035C0000035C0000035C0000035C0000035C000003700000032000000324000003280000032C0000032C0000032C0000032C0000032C0000032C00000348000003480000034800000348000003480000035C0000035C0000035C0000035C0000035C000003700000032000000324000003280000032C0000032C0000032C0000032C0000032C0000032C00000348000003480000034800000348000003480000035C0000035C0000035C0000035C0000035C00000370000400080008000800080008001C002000240028002C002C002C002C002C002C002000200020002000200020005C006000640068006C007000740078007C008000840088008C009000940098009C00A000A400A800AC00B000B400B800BC00C000C400C800CC00D000D400D800DC00E000E400E800EC00F001E857A029B32BC001E857A429B32BC401E857A829B32BC801E857A829B32BC801E857AC29B32BC801E857AC29B32BC401E857B029B32BC001E857B429B32BC001E857B829B32BB801E857BC29B32BB801E857A029B32BC001E857A429B32BC401E857A829B32BC801E857A829B32BC801E857AC29B32BC801E857AC29B32BC401E857B029B32BC001E857B429B32BC001E857B829B32BB801E857BC29B32BB801E857A029B32BC001E857A429B32BC401E857A829B32BC801E857A829B32BC801E857AC29B32BC801E857AC29B32BC401E857B029B32BC001E857B429B32BC001E857B829B32BB801E857BC29B32BB801E857A029B32BC001E857A429B32BC401E857A829B32BC801E857A829B32BC801E857AC29B32BC801E857AC29B32BC401E857B029B32BC001E857B429B32BC001E857B829B32BB801E857BC29B32BB801E857A029B32BC001E857A429B32BC401E857A829B32BC801E857A829B32BC801E857AC29B32BC801E857AC29B32BC401E857B029B32BC001E857B429B32BC001E857B829B32BB801E857BC29B32BB801E857A029B32BC001E857A429B32BC401E857A829B32BC801E857A829B32BC801E857AC29B32BC801E857AC29B32BC401E857B029B32BC001E857B429B32BC001E857B829B32BB801E857BC29B32BB80424141C1C24141C1C1C0424141C1C24141C1C1C0424141C1C24141C1C1C0424141C1C24141C1C1C0424141C1C24141C1C1C0424141C1C24141C1C1D555A9555A9555A9555A9555A9555A9555595723244324432443244324432443244324432443244324432443244324432423244324432443244324432443244324432443244324432443244324432423232323323232323232322323233232323232323232323232322323233269B49B4DA4DA6D26D36934DA4DA6D26DA6934DA4DA6D269B49B4DA4DA6D26D36934DA4DA6D26DA6934DA4DA6D2EFAFBEBEFAFBEBBEBEFAFEEBBEBEFAEFAFBEBEFAFBEBBEBEFAFEEBBEBEFA0155555555575555555555555555AAEFAFBEBEFAFBEBBEBEFAFEEBBEBEFA49B49B4DA4DA6D26D36934DA4DA6D26DA6934DA4DA6D249B49C4DA4DA6D26D36934DA4DA6D26DA6934DA4DA6D249B49C4DA4DA6D26D36934DA4DA6D26DA6934DA4DA6D2108631086410D0210C6218C4218C431884310C6210C6218C4218C621884310C6210C6218C4224949C4CA4DA6D26D36934DA4DA6D26DA6934DA4DA6D20101010102020304020301020203030203030202030302030302020302030302020303020303020203030302030202030203030202030302030302021EFAFBEBEFAFBEBBEBEFAFEEBBEBEFA5C002D00053E2F884D08660884089808B108CA08E308EF891504E205DC08FC0915092E094709600979099209AB09C409DD09F60A0F089808B108CA086608840898046508CA08660884089808B108CA08660884089808B108CA08660884089808B108CA08660884089808B108CA08660884089808B108CA08660884089808B1000000000555550000000000000000000013800500B6806D0F7DFD7DFDF5F7DFD7DFDF5DF5F7DFD7DFF75DF5F7DFD77DFD7DFDF5F7DFD7DFDF5DF5F7DFD7DFF75DF5F7DFD190170C" ;
				RawData : id=0ul,raw="415442015544434A3630353334325544434A3630353334323335363534313033333230303030304632303832303131333435363738393046523230380D02680268026800010700000138F710C038F710C02EE1C095918DD5510E52148E10D28D8C0D4CCD0C80000032000000324000003240000032000000320000003340000033800000330000003280000032400B400B000B000AC00A800A800A000A000A000A000A000A000A000A000A000A000A000A000A000A000A000A000A000A000A000A000A000A000A000A000A000A400B800B800B800B800B800B800B800B800B800B800B400B400B400B400B400B400B400B400B400B400B400B400B400B000B000B000B000A801E857A029B32BC001E857A429B32BC401E857A829B32BC801E857A829B32BC801E857AC29B32BC801E857AC29B32BC401E857B029B32BC001E857B429B32BC001E857B829B32BB801E857BC29B32BB80424141C1C24141C1C1D555A8924B24928925808440422040201008040C6309C124129228A4E738844109000100000800100420049CA0A628AE008B0005A0008000800080008000C001E84810130203227323632C8332C339033F4109A10CC110811301162119410CC110811301162119410CC110811301162119410CC110811301162119410CC110811301162119410CC110811301162119410CC110811301162119410CC110811301162119410CC110811301162119410CC110811301162119410CC110811301162119410CC1108113011621212490000272ADA100" ;
		}

		stream<uint64 id, rstring raw> Data = Custom(RawData){
			logic
				state:{
					mutable list<rstring> data=[];
				}
				onTuple
					RawData:{
						tokenize(raw,"7E",false,false,data);
						for(rstring d in data){
							submit({id=id,raw=d},Data);
						}
					}
		}

		
//		@parallel (width=1)
		stream<uint64 id, rstring raw,map<rstring,rstring> decodedMap> ExtractedDataType  = BytesParser(Data){
			param
				file : "ApplicationID.xml" ;
				id : id ;
				data : raw ;
				decoded:"decodedMap";
		}
		
		stream<uint64 theId, rstring theRaw> DataTyped = Functor(ExtractedDataType){
			output
				DataTyped:theId=(uint64)decodedMap["APPLICATION_ID"],theRaw=raw;
		}
		
//		@parallel (width=1)
		stream<uint64 theId, rstring theRaw,map<rstring,rstring> decodedMap> ExtractedData  = BytesParser(DataTyped){
			param
				file : "header.xml" ;
				id : theId ;
				data : theRaw ;
				decoded:"decodedMap";
		}
//		stream<int32 count> Agg=Aggregate(ExtractedData as Input){
//			window Input:tumbling,time(1);
//			output Agg:count=Count();
//		}
		() as display = FileSink(ExtractedData as Input)
		{
			param
				file : "/dev/stdout" ;
				flush : 1u ;
				writePunctuations : true ;
		}

}


